Bootstrap: docker
From: python:3.9.17-slim
Stage: build

%setup

%files
    #Staging files necessary individually 
    #instead of whole T6.5 repo keeps container size to a minimum
    ./ai/env-files  /home/ai/env-files
    ./ai/src        /home/ai/src
    ./ai/tests      /home/ai/tests
    ./ai/setup.py   /home/ai/setup.py
    ./ai/README.md  /home/ai/README.md

%environment
    export LC_ALL=C

%post
    #TODO: make the container work with yum
    #echo "Update yum"
    #yum -y update
    #echo "Installing Development Tools"
    #yum groupinstall -y "Development Tools"

    echo "Upgrade pip"
    pip install --upgrade pip
    echo "Installing python requirements"

    pip install -r home/ai/env-files/pytorch-env-container.txt
    echo "Installing python requirements"
    pip install -e home/ai

%runscript
    python -V
    echo "packages installed:"
    cat home/ai/env-files/pytorch-env-container.txt
    echo "Accessing itwinai module:"
    itwinai --help

%startscript

%test
    grep -q NAME=\"Debian\ GNU/Linux\" /etc/os-release
    if [ $? -eq 0 ]; then
        echo "Container base is Debian GNU/Linux as expected."
    else
        echo "Container base is not Debian GNU/Linux."
        exit 1
    fi

%labels
    Author azoechba
    Version v0.0.1

%help
    This is the base image of the itwinai library in Singularity.
