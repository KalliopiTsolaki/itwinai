Bootstrap: docker
From: python:3.9.17-slim
Stage: build

%setup

%files
<<<<<<< HEAD
    #Staging files necessary individually 
    #instead of whole T6.5 repo keeps container size to a minimum
    ./ai/env-files  /home/ai/env-files
    ./ai/src        /home/ai/src
    ./ai/tests      /home/ai/tests
    ./ai/setup.py   /home/ai/setup.py
    ./ai/README.md  /home/ai/README.md
=======
    #./requirements.txt /home/requirements.txt 
    #../ai/env-files/pytorch-env-container.txt /home/requirements.txt
    ../ /home/ai
>>>>>>> 00abab4 (ported AI and preprocessing module to singularity)

%environment
    export LC_ALL=C

%post
    #TODO: make the container work with yum
    #echo "Update yum"
    #yum -y update
    #echo "Installing Development Tools"
    #yum groupinstall -y "Development Tools"

    echo "Upgrade pip"
    pip install --upgrade pip
    echo "Installing python requirements"
<<<<<<< HEAD

    pip install -r home/ai/env-files/pytorch-env-container.txt
    echo "Installing python requirements"
    pip install -e home/ai
=======
    pip install -r /home/ai/env-files/pytorch-env-container.txt
    echo "Installing python requirements"
    pip install -e /home/ai
>>>>>>> 00abab4 (ported AI and preprocessing module to singularity)

%runscript
    python -V
    echo "packages installed:"
<<<<<<< HEAD
    cat home/ai/env-files/pytorch-env-container.txt
=======
    cat /home/ai/env-files/pytorch-env-container.txt
>>>>>>> 00abab4 (ported AI and preprocessing module to singularity)
    echo "Accessing itwinai module:"
    itwinai --help

%startscript

%test
    grep -q NAME=\"Debian\ GNU/Linux\" /etc/os-release
    if [ $? -eq 0 ]; then
        echo "Container base is Debian GNU/Linux as expected."
    else
        echo "Container base is not Debian GNU/Linux."
        exit 1
    fi

%labels
    Author azoechba
    Version v0.0.1

%help
<<<<<<< HEAD
    This is the base image of the itwinai library in Singularity.
=======
    This is a small demo building an python environment derived from the
    demo container used to illustrate a def file that uses all
    supported sections.
>>>>>>> 00abab4 (ported AI and preprocessing module to singularity)
